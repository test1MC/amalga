<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="4" MadCap:lastHeight="850" MadCap:lastWidth="624" MadCap:fileTags="TopicType.Concept,TopicOwner.v-dennk,Status.50 - InTech Review,ReleaseTarget.TAP,Personas.Elvis: App Dev,EditingTags.6 - Revised / ready for writer" MadCap:conditions="Region.US">
    <head>
        <MadCap:changeData>
            <MadCap:RemoveChange MadCap:userName="v-labenn" MadCap:initials="LLB" MadCap:id="1" MadCap:timestamp="2012-03-11T21:16:00.8444857-07:00" />
            <MadCap:AddChange MadCap:userName="v-labenn" MadCap:initials="LLB" MadCap:id="2" MadCap:timestamp="2012-03-11T21:16:00.8884769-07:00" />
            <MadCap:RemoveChange MadCap:userName="v-labenn" MadCap:initials="LLB" MadCap:id="3" MadCap:timestamp="2012-03-11T21:17:54.2398021-07:00" />
            <MadCap:AddChange MadCap:userName="v-labenn" MadCap:initials="LLB" MadCap:id="4" MadCap:timestamp="2012-03-11T21:17:54.2737953-07:00" />
        </MadCap:changeData>
        <link href="../../Resources/Stylesheets/AmalgaMain.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1 style="font-style: normal;">
            <MadCap:annotation MadCap:createDate="2012-03-11T21:23:11.3696724-07:00" MadCap:creator="v-labenn" MadCap:initials="LLB" MadCap:comment="add index entry" MadCap:editor="v-labenn" MadCap:editDate="2012-03-11T21:23:21.0847008-07:00">Adding</MadCap:annotation> existing constraints to a <MadCap:change MadCap:changes="2">d</MadCap:change><MadCap:change MadCap:changes="1">D</MadCap:change>ata<MadCap:change MadCap:changes="2">s</MadCap:change><MadCap:change MadCap:changes="1">S</MadCap:change><MadCap:annotation MadCap:createDate="2012-03-11T21:21:24.3793725-07:00" MadCap:creator="v-labenn" MadCap:initials="LLB" MadCap:comment="&quot;dataset&quot; is one word, lowercase per MSTP, unless you're talking specifically about the DataSet object." MadCap:editor="v-labenn" MadCap:editDate="2012-03-11T21:22:00.0808020-07:00">et</MadCap:annotation></h1>
        <p class="PersonaAppDev">&#160;</p>
        <p class="abstract">This topic describes how to add existing constraints to a <MadCap:change MadCap:changes="4">d</MadCap:change><MadCap:change MadCap:changes="3">D</MadCap:change>ata<MadCap:change MadCap:changes="4">s</MadCap:change><MadCap:change MadCap:changes="3">S</MadCap:change>et using the AmalgaDbDataAdapter object in <MadCap:variable name="FeatureName.Amalga ADO.NET" />.</p>
        <p>As with ADO.NET, the <span class="ForeignCodeElements">Fill</span> method of the <span class="ForeignCodeElements">AmalgaDbDataAdapter</span> object in <MadCap:variable name="FeatureName.Amalga ADO.NET" /> fills a <span class="ForeignCodeElements">DataSet</span> object only with table columns and rows from an instance of the DataConnector platform application. Although constraints are commonly set by DataConnector, the <span class="ForeignCodeElements">Fill</span> method does not add this schema information to the <span class="ForeignCodeElements">DataSet</span> object by default. </p>
        <p>To populate a <span class="ForeignCodeElements">DataSet</span> object with existing constraint information, including primary key constraints, from DataConnector, you can either call the <span class="ForeignCodeElements">FillSchema</span> method of the <span class="ForeignCodeElements">AmalgaDbDataAdapter</span> object, or set the <span class="ForeignCodeElements">MissingSchemaAction</span> property of the <span class="ForeignCodeElements">AmalgaDbDataAdapter</span> object to <span class="ForeignCodeElements">MissingSchemaAction.AddWithKey</span> before calling the <span class="ForeignCodeElements">Fill</span> method. For more information about adding existing constraints to a <span class="ForeignCodeElements">DataSet</span> object, see <a href="http://msdn.microsoft.com/library/49z48hxc.aspx">Adding Existing Constraints to a DataSet (ADO.NET)</a><MadCap:conditionalText MadCap:conditions="Production.PrintOnly">, on Microsoft Developer Network <MadCap:annotation MadCap:createDate="2012-03-11T21:19:39.1938921-07:00" MadCap:creator="v-labenn" MadCap:initials="LLB" MadCap:comment="Dennis, pls check your email, I sent you FWlinks on Friday, including FWLink for this one.." MadCap:editor="v-labenn" MadCap:editDate="2012-03-11T21:20:28.9719138-07:00">at</MadCap:annotation> <![CDATA[ ]]><a href="http://msdn.microsoft.com/library/49z48hxc.aspx">http://msdn.microsoft.com/library/49z48hxc.aspx</a></MadCap:conditionalText>.</p>
        <h2>Example</h2>
        <p>The following example sets the <span class="ForeignCodeElements">MissingSchemaAction</span> property of the <span class="ForeignCodeElements">AmalgaDbDataAdapter</span> to <span class="ForeignCodeElements">MissingSchemaAction.Add.WithKey</span>, to ensure that primary key constraints are retrieved and added to a <span class="ForeignCodeElements">DataSet</span> object when the <span class="ForeignCodeElements">Fill</span> method of the <span class="ForeignCodeElements">AmalgaDbDataAdapter</span> object is invoked.</p><pre xml:space="preserve">private AmalgaDbDataAdapter CreatePatientNoteDataAdapter(AmalgaDbConnection connection)
{
    // Create an AmalgaDbDataAdapter object.
    AmalgaDbDataAdapter adapter = new AmalgaDbDataAdapter();

    // Ensure that primary key constraints are added to any DataSet object
    // filled by invoking the Fill method of this object.
    adapter.MissingSchemaAction = MissingSchemaAction.AddWithKey;

    // Create new AmalgaDbCommand objects for each command.
    adapter.SelectCommand = new AmalgaDbCommand();
    adapter.InsertCommand = new AmalgaDbCommand();
    adapter.UpdateCommand = new AmalgaDbCommand();
    adapter.DeleteCommand = new AmalgaDbCommand();

    // Set the CommandText properties for the AmalgaDbCommand objects
    // to be used by the AmalgaDbDataAdapter.
    adapter.SelectCommand.CommandText =
        @"SELECT [NoteID], [NoteText], [PatientPersonID] FROM [PatientNote]";
    adapter.InsertCommand.CommandText =
        @"INSERT INTO [PatientNote] ([NoteID], [NoteText], [PatientPersonID]) " + 
        "VALUES (@NoteID, @NoteText, @PatientPersonID)";
    adapter.UpdateCommand.CommandText =
        @"UPDATE [PatientNote] SET [NoteID]=@NoteID, [NoteText]=@NoteText, " + 
        "[PatientPersonID]=@PatientPersonID WHERE NoteID=@oldNoteID";
    adapter.DeleteCommand.CommandText =
        @"DELETE FROM [PatientNote] WHERE NoteID=@NoteID";

    // Define the AmalgaDbParameter objects used by the AmalgaDbCommand
    // objects.
    adapter.InsertCommand.Parameters.Add("@NoteID", SqlDbType.Int, 4, "NoteID");
    adapter.InsertCommand.Parameters.Add("@NoteText", SqlDbType.NVarChar, 4000, "NoteText");
    adapter.InsertCommand.Parameters.Add("@PatientPersonID", 
        SqlDbType.NVarChar, 80, "PatientPersonID");

    adapter.UpdateCommand.Parameters.Add("@NoteID", SqlDbType.Int, 4, "NoteID");
    adapter.UpdateCommand.Parameters.Add("@NoteText", SqlDbType.NVarChar, 4000, "NoteText");
    adapter.UpdateCommand.Parameters.Add("@PatientPersonID", 
        SqlDbType.NVarChar, 80, "PatientPersonID");
    adapter.UpdateCommand.Parameters.Add("@oldNoteID", 
        SqlDbType.Int, 4, "NoteID").SourceVersion = DataRowVersion.Original;

    adapter.DeleteCommand.Parameters.Add("@NoteID", SqlDbType.Int, 4, "NoteID");

    // Return the newly defined AmalgaDbDataAdapter.
    return adapter;
}
     <![CDATA[
]]></pre>
        <p class="SeeAlso" MadCap:conditions="Production.doNOTbuild">See also</p>
        <p class="SeeAlsoSubHead" MadCap:conditions="Production.doNOTbuild">Tasks</p>
        <p MadCap:conditions="Production.doNOTbuild">[Cross reference or hyperlink if external resource]</p>
        <p class="SeeAlsoSubHead" MadCap:conditions="Production.doNOTbuild">References</p>
        <p MadCap:conditions="Production.doNOTbuild">[Cross reference or hyperlink if external resource]</p>
        <p class="SeeAlsoSubHead" MadCap:conditions="Production.doNOTbuild">Concepts</p>
        <p MadCap:conditions="Production.doNOTbuild">[Cross reference or hyperlink if external resource]</p>
        <p class="SeeAlsoSubHead" MadCap:conditions="Production.doNOTbuild">Other resources </p>
        <p MadCap:conditions="Production.doNOTbuild">[Cross reference or hyperlink if external resource]</p>
    </body>
</html>