<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:fileTags="Personas.Elvis: App Dev,TopicOwner.v-dennk,ReleaseTarget.CTP1,TopicType.Concept,EditingTags.7 - Editing issues resolved,Status.60 - Revising" MadCap:lastBlockDepth="4" MadCap:lastHeight="2728" MadCap:lastWidth="576">
    <head>
        <link href="../Resources/Stylesheets/AmalgaMain.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Virtual schemas</h1>
        <p class="abstract">
            <MadCap:keyword term="virtual schema;application views;Amalga ADO.NET" />This topic describes virtual schemas, including information on exposing, reading, and writing data in hosted applications.</p>
        <p>Entities provide a single place to map a concept to site-specific SQL Server data. Each application contains a virtual schema which consists of application views that contain entities. Reading and writing data is very similar to ADO.NET, but with special Amalga classes that use the application view names rather than the SQL Server view names.</p>
        <p class="Label">Sections in this <MadCap:annotation MadCap:createDate="2011-08-19T01:34:42.5579315-07:00" MadCap:creator="v-ciwyco" MadCap:initials="CJW" MadCap:comment="Unless otherwise noted, the hyperllinks in the topic should be changed to  cross-references. Two reasons: in print format, the xref shows a page number; and the xref will change if the heading changes. The hyperllink won't show a page number and  will have to be changed manually to match a changed heading." MadCap:editor="v-ciwyco" MadCap:editDate="2011-08-19T01:37:44.2793315-07:00">topic:</MadCap:annotation></p>
        <ul>
            <li>
                <MadCap:xref href="#Entities" target="" title="" alt="">Amalga Entities on page 1</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Virtual" target="" title="" alt="">Virtual Schema and Application Views on page 1</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Reading" target="" title="" alt="">Reading and Writing Data on page 1</MadCap:xref>
            </li>
        </ul>
        <p>Hosted applications in <MadCap:variable name="BrandingHSG.AmalgaV3 first use" /> use a conceptual data model to access data, instead of directly interacting with a relational storage schema. This conceptual data model is represented by a <MadCap:variable name="FeatureName.virtual schema" />.</p>
        <p>The virtual schema enables you to focus on business logic without exposing the details of how the underlying data is stored. With virtual schemas, applications are more portable, because applications are freed from hard-coded dependencies on a particular storage schema. The mappings between the conceptual data model and the underlying data structures, such as tables and columns, can be changed without changing the code for the hosted application. </p>
        <p>To build an Amalga application using previous technology, you would need to know where all of the necessary data is stored. Using data  becomes especially complex when you need to combine data from multiple  sources. If IT makes any changes to how a database is structured, it affects all applications that use that database. </p>
        <p>The following diagram shows a comparison between how  previous systems and Amalga V3 handles data.</p>
        <p class="Figure">
            <img src="Images/AmalgaVirtualSchemaAdvantages.png" MadCap:mediastyle="@media print { height: auto;width: 6in; }" style="height: auto;width: 700px;" />
        </p>
        <p>&#160;</p>
        <h2><a name="Entities"></a>
            <MadCap:annotation MadCap:createDate="2011-08-11T16:36:40.2984783-07:00" MadCap:creator="v-labenn" MadCap:initials="LLB" MadCap:comment="Make these headings (Entities,Virtual Schema and Application Views, Reading and Writing Data) linkable (bookmarked) from the top of the topic.\r\n\r\nCJW]  Oh,dear. I will let LLB know that you don't need to create bookmarks to link to the headings. Sorry for the confusion." MadCap:editor="v-ciwyco" MadCap:editDate="2011-08-19T01:31:10.3595315-07:00">Amalga Entities</MadCap:annotation>
        </h2>
        <p>Amalga Entities represent any healthcare or organizational concept that you might need to centrally manage and expose to applications running on the Amalga data platform. Examples include patients, visits, and lab results. They provide a single place to map a concept to site-specific <MadCap:annotation MadCap:createDate="2011-08-12T17:01:41.9211405-07:00" MadCap:creator="v-ciwyco" MadCap:initials="CJW" MadCap:comment="All the data accessed by virtual schema  is kept in SQL Server tables? \r\n[PG] That's my understanding." MadCap:editor="v-pegrue" MadCap:editDate="2011-08-15T16:35:29.4665906-07:00">SQL</MadCap:annotation> Server data. Note that patient data could be scattered across multiple tables and databases, but only one patient entity is required for the mapping. </p>
        <p>Amalga V3 ships with common entities that are used in most Amalga applications. However, you can easily create your own entities as well. Your application then interacts with the entities through a Virtual Schema, rather than through the databases directly, making the application much more portable.</p>
        <p>The mappings between entities and data are created by IT. Amalga partly automates this process by using semantic tags and <a href="Terminology/SDK_OVW_Using_Terminology_Services.htm">Terminology Services</a> — when data is processed by Amalga, it is automatically tagged; by applying the same tags to Amalga entity definitions, the mapping between Amalga entities and physical schema can be automated. </p>
        <p>Administrators of the <MadCap:variable name="BrandingHSG.AmalgaV3 second use" /> system manage these Amalga entities through the <MadCap:variable name="FeatureName.Management Console second use" />. In particular, access to data is centrally managed on these Amalga entities using the Amalga Access Control Framework. It is possible for an Amalga administrator to change the mapping of entities, without having to change the application code.</p>
        <p>Application developers and IT professionals can extend the set of common Amalga entities with new entities based on their application and organization requirements.</p>
        <h2><a name="Virtual"></a>Virtual Schema and Application Views</h2>
        <p>A virtual schema acts as a <MadCap:annotation MadCap:createDate="2011-08-12T17:14:11.6948062-07:00" MadCap:creator="v-ciwyco" MadCap:initials="CJW" MadCap:comment="Virtual schema=data contract=XML data manifest? and  composed of app views.  The &quot;composed of app views&quot; I sort of get, but the other equivalencies don't compute so much.  Are they all different formats of the same thing?\r\n[PG] Yes, they are the same thing. I would say &quot;virtual schema&quot; is the name, &quot;data contract&quot; is the concept that it embodies, and XML data manifest is how it is implemented. Let me know if you have better phrasing as to how to get that across.\r\n\r\n[CJW] Not yet &lt;g&gt;.  I like your revision, however." MadCap:editor="v-ciwyco" MadCap:editDate="2011-08-19T01:32:46.9977315-07:00">data contract</MadCap:annotation> for the application, specifying which data entities the application will use. A virtual schema consists of one or more application views. The virtual schema is essentially a virtual database,  analogous to SQL Server database which  consists of one or more tables or views. You can create a virtual schema using the <a href="SDK_CON_Virtual_Schema_Designer.htm">Virtual Schema Designer</a> that is accessible in Visual Studio 2010 with the Amalga v3 development tools. The virtual schema is represented by a data manifest XML&#160;file that is part of application and service projects. This data manifest file is packaged with each Amalga v3 application or service.</p>
        <p class="note">An application cannot have more than one virtual schema.</p>
        <p>Once your virtual schema is created, you can read and write data against the virtual schema using Amalga ADO.NET. API calls that are designed to work exactly like ADO.NET, except that  <MadCap:annotation MadCap:createDate="2011-08-12T17:19:06.6964727-07:00" MadCap:creator="v-ciwyco" MadCap:initials="CJW" MadCap:comment="is there a more precise way to say this? &quot;pass in&quot; is common usage, but more precise would be &quot;pass xxx&quot; where xxx is the type or th e actual name of the thing they are using in the statement.  Also &quot;pass in&quot;  would be IMO hard to localize.\r\nCJW -- revisions work" MadCap:editor="v-ciwyco" MadCap:editDate="2011-08-19T01:39:48.1037315-07:00">you use </MadCap:annotation>the application view name where you would normally use the SQL&#160;view name. Amalga v3 ADO.NET queries and transactions are expressed in the code in terms of application views in the virtual schema, allowing you to port applications across varying physical schemas without needing to rewrite the query code.  Using the Amalga ADO.NET APIs, you can make <MadCap:annotation MadCap:createDate="2011-08-29T16:25:23.3440260-07:00" MadCap:creator="v-pegrue" MadCap:initials="PG" MadCap:comment="I decided to have both SQL and T-SQL, since apparently SQL means read only, and T-SQL is SQL plus writing, and therefore implies writing action." MadCap:editor="v-pegrue" MadCap:editDate="2011-08-29T16:26:56.0953002-07:00">SQL and T-SQL</MadCap:annotation> calls using the application view names.</p>
        <p>When the application is installed, Amalga automatically binds application views to the Amalga entities deployed at a site, or automatically creates new entities that an administrator can bind to the physical SQL schema in case these entities do not exist. Amalga then optimizes data access based on the application view definition and access control filters  on the Amalga entities defined by an administrator.</p>
        <h2><a name="Reading"></a>Reading and Writing Data</h2>
        <p>To read data through the virtual schema, you create code that works like ADO.NET, but with classes from <MadCap:annotation MadCap:createDate="2011-08-11T17:12:11.5699423-07:00" MadCap:creator="v-labenn" MadCap:initials="LLB" MadCap:comment="to CjW: Do we need vaiable name here? [CJW] yes" MadCap:editor="v-ciwyco" MadCap:editDate="2011-08-12T17:29:29.3446709-07:00">Amalga fabric</MadCap:annotation> libraries. See <MadCap:xref href="SDK_OVW_ADO.NET_Overview.htm" target="" title="" alt="">Amalga ADO.NET Library Overview</MadCap:xref> for more information about Amalga ADO.NET.</p>
        <p class="caution">Both Amalga applications and Amalga WCF services can make use of Amalga ADO.NET in order to use virtual schemas. However, it is recommended that applications call WCF services, which in turn, use virtual schemas. Although it is possible for applications to use virtual schemas directly, this is not recommended for production use, since direct access cannot take advantage of service-oriented architecture, such as clustering. </p>
        <h2>See Also</h2>
        <p>
            <MadCap:xref href="SDK_OVW_ADO.NET_Overview.htm" target="" title="" alt="">Amalga ADO.NET Library Overview</MadCap:xref>
        </p>
    </body>
</html>